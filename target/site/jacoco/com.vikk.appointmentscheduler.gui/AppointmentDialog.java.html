<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppointmentDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Appointment Scheduling Optimizer</a> &gt; <a href="index.source.html" class="el_package">com.vikk.appointmentscheduler.gui</a> &gt; <span class="el_source">AppointmentDialog.java</span></div><h1>AppointmentDialog.java</h1><pre class="source lang-java linenums">package com.vikk.appointmentscheduler.gui;

import com.vikk.appointmentscheduler.model.Appointment;
import com.vikk.appointmentscheduler.model.AppointmentStatus;
import com.vikk.appointmentscheduler.model.AppointmentType;
import com.vikk.appointmentscheduler.model.Priority;

import javafx.geometry.Insets;
import javafx.scene.Scene;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.ButtonType;
import javafx.scene.control.CheckBox;
import javafx.scene.control.ComboBox;
import javafx.scene.control.DatePicker;
import javafx.scene.control.Dialog;
import javafx.scene.control.Label;
import javafx.scene.control.Spinner;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.layout.ColumnConstraints;
import javafx.scene.layout.GridPane;
import javafx.scene.layout.HBox;
import javafx.scene.layout.VBox;
import javafx.stage.Modality;
import javafx.stage.Stage;

import java.time.Duration;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.util.HashSet;
import java.util.Set;

/**
 * Dialog for creating and editing appointments.
 */
public class AppointmentDialog {
<span class="nc" id="L39">    private static final DateTimeFormatter FORMATTER = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm&quot;);</span>
    
    private Stage dialog;
    private Appointment appointment;
    private boolean isEdit;
    
    // Form controls
    private TextField idField;
    private TextField titleField;
    private TextArea descriptionArea;
    private DatePicker startDatePicker;
    private Spinner&lt;Integer&gt; startHourSpinner;
    private Spinner&lt;Integer&gt; startMinuteSpinner;
    private Spinner&lt;Integer&gt; durationSpinner;
    private ComboBox&lt;AppointmentType&gt; typeComboBox;
    private ComboBox&lt;Priority&gt; priorityComboBox;
    private ComboBox&lt;AppointmentStatus&gt; statusComboBox;
    private TextField resourceIdField;
    private TextField clientIdField;
    private CheckBox flexibleCheckBox;
    private Spinner&lt;Integer&gt; flexibilitySpinner;
    private Spinner&lt;Double&gt; importanceSpinner;
    private TextArea capabilitiesArea;
    
<span class="nc" id="L63">    public AppointmentDialog(Stage parent, Appointment appointment) {</span>
<span class="nc" id="L64">        this.appointment = appointment;</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">        this.isEdit = appointment != null;</span>
<span class="nc" id="L66">        createDialog(parent);</span>
<span class="nc" id="L67">    }</span>
    
    private void createDialog(Stage parent) {
<span class="nc" id="L70">        dialog = new Stage();</span>
<span class="nc" id="L71">        dialog.initModality(Modality.APPLICATION_MODAL);</span>
<span class="nc" id="L72">        dialog.initOwner(parent);</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        dialog.setTitle(isEdit ? &quot;Edit Appointment&quot; : &quot;Add New Appointment&quot;);</span>
<span class="nc" id="L74">        dialog.setResizable(true);</span>
        
<span class="nc" id="L76">        VBox mainLayout = new VBox(15);</span>
<span class="nc" id="L77">        mainLayout.setPadding(new Insets(20));</span>
        
        // Create form
<span class="nc" id="L80">        GridPane form = createForm();</span>
<span class="nc" id="L81">        mainLayout.getChildren().add(form);</span>
        
        // Create buttons
<span class="nc" id="L84">        HBox buttonBox = createButtons();</span>
<span class="nc" id="L85">        mainLayout.getChildren().add(buttonBox);</span>
        
<span class="nc" id="L87">        Scene scene = new Scene(mainLayout, 700, 800);</span>
<span class="nc" id="L88">        dialog.setScene(scene);</span>
        
        // Populate form if editing
<span class="nc bnc" id="L91" title="All 2 branches missed.">        if (isEdit) {</span>
<span class="nc" id="L92">            populateForm();</span>
        }
<span class="nc" id="L94">    }</span>
    
    private GridPane createForm() {
<span class="nc" id="L97">        GridPane form = new GridPane();</span>
<span class="nc" id="L98">        form.setHgap(15);</span>
<span class="nc" id="L99">        form.setVgap(12);</span>
<span class="nc" id="L100">        form.setPadding(new Insets(10));</span>
        
        // Set column constraints for better layout
<span class="nc" id="L103">        ColumnConstraints labelCol = new ColumnConstraints();</span>
<span class="nc" id="L104">        labelCol.setMinWidth(150);</span>
<span class="nc" id="L105">        labelCol.setPrefWidth(150);</span>
        
<span class="nc" id="L107">        ColumnConstraints fieldCol = new ColumnConstraints();</span>
<span class="nc" id="L108">        fieldCol.setMinWidth(200);</span>
<span class="nc" id="L109">        fieldCol.setPrefWidth(300);</span>
<span class="nc" id="L110">        fieldCol.setHgrow(javafx.scene.layout.Priority.ALWAYS);</span>
        
<span class="nc" id="L112">        form.getColumnConstraints().addAll(labelCol, fieldCol);</span>
        
<span class="nc" id="L114">        int row = 0;</span>
        
        // ID
<span class="nc" id="L117">        form.add(new Label(&quot;ID:&quot;), 0, row);</span>
<span class="nc" id="L118">        idField = new TextField();</span>
<span class="nc" id="L119">        idField.setPromptText(&quot;e.g., APT001&quot;);</span>
<span class="nc" id="L120">        form.add(idField, 1, row++);</span>
        
        // Title
<span class="nc" id="L123">        form.add(new Label(&quot;Title:&quot;), 0, row);</span>
<span class="nc" id="L124">        titleField = new TextField();</span>
<span class="nc" id="L125">        titleField.setPromptText(&quot;Appointment title&quot;);</span>
<span class="nc" id="L126">        form.add(titleField, 1, row++);</span>
        
        // Description
<span class="nc" id="L129">        form.add(new Label(&quot;Description:&quot;), 0, row);</span>
<span class="nc" id="L130">        descriptionArea = new TextArea();</span>
<span class="nc" id="L131">        descriptionArea.setPromptText(&quot;Appointment description&quot;);</span>
<span class="nc" id="L132">        descriptionArea.setPrefRowCount(3);</span>
<span class="nc" id="L133">        form.add(descriptionArea, 1, row++);</span>
        
        // Start Date and Time
<span class="nc" id="L136">        form.add(new Label(&quot;Start Date:&quot;), 0, row);</span>
<span class="nc" id="L137">        startDatePicker = new DatePicker();</span>
<span class="nc" id="L138">        startDatePicker.setValue(LocalDateTime.now().toLocalDate());</span>
<span class="nc" id="L139">        form.add(startDatePicker, 1, row++);</span>
        
<span class="nc" id="L141">        form.add(new Label(&quot;Start Time:&quot;), 0, row);</span>
<span class="nc" id="L142">        HBox timeBox = new HBox(5);</span>
<span class="nc" id="L143">        startHourSpinner = new Spinner&lt;&gt;(0, 23, LocalDateTime.now().getHour());</span>
<span class="nc" id="L144">        startMinuteSpinner = new Spinner&lt;&gt;(0, 59, LocalDateTime.now().getMinute());</span>
<span class="nc" id="L145">        timeBox.getChildren().addAll(</span>
            new Label(&quot;Hour:&quot;), startHourSpinner,
            new Label(&quot;Min:&quot;), startMinuteSpinner
        );
<span class="nc" id="L149">        form.add(timeBox, 1, row++);</span>
        
        // Duration
<span class="nc" id="L152">        form.add(new Label(&quot;Duration (min):&quot;), 0, row);</span>
<span class="nc" id="L153">        durationSpinner = new Spinner&lt;&gt;(15, 480, 60);</span>
<span class="nc" id="L154">        durationSpinner.setEditable(true);</span>
<span class="nc" id="L155">        form.add(durationSpinner, 1, row++);</span>
        
        // Type
<span class="nc" id="L158">        form.add(new Label(&quot;Type:&quot;), 0, row);</span>
<span class="nc" id="L159">        typeComboBox = new ComboBox&lt;&gt;();</span>
<span class="nc" id="L160">        typeComboBox.getItems().addAll(AppointmentType.values());</span>
<span class="nc" id="L161">        typeComboBox.setValue(AppointmentType.CONSULTATION);</span>
<span class="nc" id="L162">        form.add(typeComboBox, 1, row++);</span>
        
        // Priority
<span class="nc" id="L165">        form.add(new Label(&quot;Priority:&quot;), 0, row);</span>
<span class="nc" id="L166">        priorityComboBox = new ComboBox&lt;&gt;();</span>
<span class="nc" id="L167">        priorityComboBox.getItems().addAll(Priority.values());</span>
<span class="nc" id="L168">        priorityComboBox.setValue(Priority.MEDIUM);</span>
<span class="nc" id="L169">        form.add(priorityComboBox, 1, row++);</span>
        
        // Status
<span class="nc" id="L172">        form.add(new Label(&quot;Status:&quot;), 0, row);</span>
<span class="nc" id="L173">        statusComboBox = new ComboBox&lt;&gt;();</span>
<span class="nc" id="L174">        statusComboBox.getItems().addAll(AppointmentStatus.values());</span>
<span class="nc" id="L175">        statusComboBox.setValue(AppointmentStatus.PENDING);</span>
<span class="nc" id="L176">        form.add(statusComboBox, 1, row++);</span>
        
        // Resource ID
<span class="nc" id="L179">        form.add(new Label(&quot;Resource ID:&quot;), 0, row);</span>
<span class="nc" id="L180">        resourceIdField = new TextField();</span>
<span class="nc" id="L181">        resourceIdField.setPromptText(&quot;Optional - will be assigned by scheduler&quot;);</span>
<span class="nc" id="L182">        form.add(resourceIdField, 1, row++);</span>
        
        // Client ID
<span class="nc" id="L185">        form.add(new Label(&quot;Client ID:&quot;), 0, row);</span>
<span class="nc" id="L186">        clientIdField = new TextField();</span>
<span class="nc" id="L187">        clientIdField.setPromptText(&quot;Client identifier&quot;);</span>
<span class="nc" id="L188">        form.add(clientIdField, 1, row++);</span>
        
        // Flexible
<span class="nc" id="L191">        form.add(new Label(&quot;Flexible:&quot;), 0, row);</span>
<span class="nc" id="L192">        flexibleCheckBox = new CheckBox(&quot;Appointment time can be adjusted&quot;);</span>
<span class="nc" id="L193">        form.add(flexibleCheckBox, 1, row++);</span>
        
        // Flexibility Window
<span class="nc" id="L196">        form.add(new Label(&quot;Flexibility (min):&quot;), 0, row);</span>
<span class="nc" id="L197">        flexibilitySpinner = new Spinner&lt;&gt;(0, 240, 30);</span>
<span class="nc" id="L198">        flexibilitySpinner.setEditable(true);</span>
<span class="nc" id="L199">        form.add(flexibilitySpinner, 1, row++);</span>
        
        // Importance Score
<span class="nc" id="L202">        form.add(new Label(&quot;Importance Score:&quot;), 0, row);</span>
<span class="nc" id="L203">        importanceSpinner = new Spinner&lt;&gt;(0.1, 10.0, 1.0, 0.1);</span>
<span class="nc" id="L204">        importanceSpinner.setEditable(true);</span>
<span class="nc" id="L205">        form.add(importanceSpinner, 1, row++);</span>
        
        // Capabilities
<span class="nc" id="L208">        form.add(new Label(&quot;Required Capabilities:&quot;), 0, row);</span>
<span class="nc" id="L209">        capabilitiesArea = new TextArea();</span>
<span class="nc" id="L210">        capabilitiesArea.setPromptText(&quot;Enter capabilities separated by commas (e.g., CONSULTATION, EMERGENCY)&quot;);</span>
<span class="nc" id="L211">        capabilitiesArea.setPrefRowCount(2);</span>
<span class="nc" id="L212">        form.add(capabilitiesArea, 1, row++);</span>
        
<span class="nc" id="L214">        return form;</span>
    }
    
    private HBox createButtons() {
<span class="nc" id="L218">        HBox buttonBox = new HBox(10);</span>
<span class="nc" id="L219">        buttonBox.setPadding(new Insets(20, 0, 0, 0));</span>
        
<span class="nc bnc" id="L221" title="All 2 branches missed.">        Button saveButton = new Button(isEdit ? &quot;Update&quot; : &quot;Save&quot;);</span>
<span class="nc" id="L222">        saveButton.setDefaultButton(true);</span>
<span class="nc" id="L223">        saveButton.setOnAction(e -&gt; saveAppointment());</span>
        
<span class="nc" id="L225">        Button cancelButton = new Button(&quot;Cancel&quot;);</span>
<span class="nc" id="L226">        cancelButton.setOnAction(e -&gt; dialog.close());</span>
        
<span class="nc" id="L228">        buttonBox.getChildren().addAll(saveButton, cancelButton);</span>
        
<span class="nc" id="L230">        return buttonBox;</span>
    }
    
    private void populateForm() {
<span class="nc bnc" id="L234" title="All 2 branches missed.">        if (appointment == null) return;</span>
        
<span class="nc" id="L236">        idField.setText(appointment.getId());</span>
<span class="nc" id="L237">        titleField.setText(appointment.getTitle());</span>
<span class="nc" id="L238">        descriptionArea.setText(appointment.getDescription());</span>
        
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (appointment.getStartTime() != null) {</span>
<span class="nc" id="L241">            startDatePicker.setValue(appointment.getStartTime().toLocalDate());</span>
<span class="nc" id="L242">            startHourSpinner.getValueFactory().setValue(appointment.getStartTime().getHour());</span>
<span class="nc" id="L243">            startMinuteSpinner.getValueFactory().setValue(appointment.getStartTime().getMinute());</span>
        }
        
<span class="nc" id="L246">        durationSpinner.getValueFactory().setValue((int) appointment.getDurationMinutes());</span>
<span class="nc" id="L247">        typeComboBox.setValue(appointment.getType());</span>
<span class="nc" id="L248">        priorityComboBox.setValue(appointment.getPriority());</span>
<span class="nc" id="L249">        statusComboBox.setValue(appointment.getStatus());</span>
<span class="nc" id="L250">        resourceIdField.setText(appointment.getResourceId());</span>
<span class="nc" id="L251">        clientIdField.setText(appointment.getClientId());</span>
<span class="nc" id="L252">        flexibleCheckBox.setSelected(appointment.isFlexible());</span>
<span class="nc" id="L253">        flexibilitySpinner.getValueFactory().setValue((int) appointment.getFlexibilityWindow().toMinutes());</span>
<span class="nc" id="L254">        importanceSpinner.getValueFactory().setValue(appointment.getImportanceScore());</span>
        
        // Capabilities
<span class="nc" id="L257">        Set&lt;String&gt; allCapabilities = new HashSet&lt;&gt;(appointment.getRequiredCapabilities());</span>
<span class="nc" id="L258">        allCapabilities.addAll(appointment.getPreferredCapabilities());</span>
<span class="nc" id="L259">        capabilitiesArea.setText(String.join(&quot;, &quot;, allCapabilities));</span>
<span class="nc" id="L260">    }</span>
    
    private void saveAppointment() {
        try {
            // Validate required fields
<span class="nc bnc" id="L265" title="All 2 branches missed.">            if (idField.getText().trim().isEmpty()) {</span>
<span class="nc" id="L266">                showAlert(&quot;Validation Error&quot;, &quot;ID is required&quot;);</span>
<span class="nc" id="L267">                return;</span>
            }
<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (titleField.getText().trim().isEmpty()) {</span>
<span class="nc" id="L270">                showAlert(&quot;Validation Error&quot;, &quot;Title is required&quot;);</span>
<span class="nc" id="L271">                return;</span>
            }
<span class="nc bnc" id="L273" title="All 2 branches missed.">            if (startDatePicker.getValue() == null) {</span>
<span class="nc" id="L274">                showAlert(&quot;Validation Error&quot;, &quot;Start date is required&quot;);</span>
<span class="nc" id="L275">                return;</span>
            }
            
            // Create or update appointment
<span class="nc bnc" id="L279" title="All 2 branches missed.">            if (appointment == null) {</span>
<span class="nc" id="L280">                appointment = new Appointment();</span>
            }
            
<span class="nc" id="L283">            appointment.setId(idField.getText().trim());</span>
<span class="nc" id="L284">            appointment.setTitle(titleField.getText().trim());</span>
<span class="nc" id="L285">            appointment.setDescription(descriptionArea.getText().trim());</span>
            
            // Set start time
<span class="nc" id="L288">            LocalDateTime startTime = LocalDateTime.of(</span>
<span class="nc" id="L289">                startDatePicker.getValue(),</span>
<span class="nc" id="L290">                LocalTime.of(startHourSpinner.getValue().intValue(), startMinuteSpinner.getValue().intValue())</span>
            );
<span class="nc" id="L292">            appointment.setStartTime(startTime);</span>
            
            // Set duration and end time
<span class="nc" id="L295">            int durationMinutes = durationSpinner.getValue();</span>
<span class="nc" id="L296">            appointment.setDuration(Duration.ofMinutes(durationMinutes));</span>
<span class="nc" id="L297">            appointment.setEndTime(startTime.plusMinutes(durationMinutes));</span>
            
<span class="nc" id="L299">            appointment.setType(typeComboBox.getValue());</span>
<span class="nc" id="L300">            appointment.setPriority(priorityComboBox.getValue());</span>
<span class="nc" id="L301">            appointment.setStatus(statusComboBox.getValue());</span>
<span class="nc" id="L302">            appointment.setResourceId(resourceIdField.getText().trim());</span>
<span class="nc" id="L303">            appointment.setClientId(clientIdField.getText().trim());</span>
<span class="nc" id="L304">            appointment.setFlexible(flexibleCheckBox.isSelected());</span>
<span class="nc" id="L305">            appointment.setFlexibilityWindow(Duration.ofMinutes(flexibilitySpinner.getValue()));</span>
<span class="nc" id="L306">            appointment.setImportanceScore(importanceSpinner.getValue());</span>
            
            // Parse capabilities
<span class="nc" id="L309">            String capabilitiesText = capabilitiesArea.getText().trim();</span>
<span class="nc" id="L310">            Set&lt;String&gt; capabilities = new HashSet&lt;&gt;();</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">            if (!capabilitiesText.isEmpty()) {</span>
<span class="nc" id="L312">                String[] parts = capabilitiesText.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                for (String part : parts) {</span>
<span class="nc" id="L314">                    capabilities.add(part.trim().toUpperCase());</span>
                }
            }
<span class="nc" id="L317">            appointment.setRequiredCapabilities(capabilities);</span>
<span class="nc" id="L318">            appointment.setPreferredCapabilities(new HashSet&lt;&gt;());</span>
            
<span class="nc" id="L320">            dialog.close();</span>
            
<span class="nc" id="L322">        } catch (Exception e) {</span>
<span class="nc" id="L323">            showAlert(&quot;Error&quot;, &quot;Failed to save appointment: &quot; + e.getMessage());</span>
<span class="nc" id="L324">        }</span>
<span class="nc" id="L325">    }</span>
    
    private void showAlert(String title, String message) {
<span class="nc" id="L328">        Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L329">        alert.setTitle(title);</span>
<span class="nc" id="L330">        alert.setHeaderText(null);</span>
<span class="nc" id="L331">        alert.setContentText(message);</span>
<span class="nc" id="L332">        alert.showAndWait();</span>
<span class="nc" id="L333">    }</span>
    
    public Appointment showAndWait() {
<span class="nc" id="L336">        dialog.showAndWait();</span>
<span class="nc" id="L337">        return appointment;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>