<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Schedule.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Appointment Scheduling Optimizer</a> &gt; <a href="index.source.html" class="el_package">com.vikk.appointmentscheduler.model</a> &gt; <span class="el_source">Schedule.java</span></div><h1>Schedule.java</h1><pre class="source lang-java linenums">package com.vikk.appointmentscheduler.model;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;

/**
 * Represents a complete schedule with appointments and their resource assignments.
 */
public class Schedule {
    private String id;
    private LocalDateTime startDate;
    private LocalDateTime endDate;
    private List&lt;Appointment&gt; appointments;
    private Map&lt;String, String&gt; resourceAssignments; // appointmentId -&gt; resourceId
    private Map&lt;String, List&lt;Appointment&gt;&gt; resourceSchedules; // resourceId -&gt; appointments
    private double totalCost;
    private double totalScore;
    private int conflictCount;
    private Set&lt;String&gt; unassignedAppointments;
    private ScheduleMetrics metrics;

<span class="fc" id="L28">    public Schedule() {</span>
<span class="fc" id="L29">        this.appointments = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L30">        this.resourceAssignments = new HashMap&lt;&gt;();</span>
<span class="fc" id="L31">        this.resourceSchedules = new HashMap&lt;&gt;();</span>
<span class="fc" id="L32">        this.unassignedAppointments = new HashSet&lt;&gt;();</span>
<span class="fc" id="L33">        this.metrics = new ScheduleMetrics();</span>
<span class="fc" id="L34">    }</span>

    public Schedule(String id, LocalDateTime startDate, LocalDateTime endDate) {
<span class="fc" id="L37">        this();</span>
<span class="fc" id="L38">        this.id = id;</span>
<span class="fc" id="L39">        this.startDate = startDate;</span>
<span class="fc" id="L40">        this.endDate = endDate;</span>
<span class="fc" id="L41">    }</span>

    // Getters and setters
    public String getId() {
<span class="fc" id="L45">        return id;</span>
    }

    public void setId(String id) {
<span class="fc" id="L49">        this.id = id;</span>
<span class="fc" id="L50">    }</span>

    public LocalDateTime getStartDate() {
<span class="fc" id="L53">        return startDate;</span>
    }

    public void setStartDate(LocalDateTime startDate) {
<span class="fc" id="L57">        this.startDate = startDate;</span>
<span class="fc" id="L58">    }</span>

    public LocalDateTime getEndDate() {
<span class="fc" id="L61">        return endDate;</span>
    }

    public void setEndDate(LocalDateTime endDate) {
<span class="fc" id="L65">        this.endDate = endDate;</span>
<span class="fc" id="L66">    }</span>

    public List&lt;Appointment&gt; getAppointments() {
<span class="fc" id="L69">        return appointments;</span>
    }

    public void setAppointments(List&lt;Appointment&gt; appointments) {
<span class="nc" id="L73">        this.appointments = appointments;</span>
<span class="nc" id="L74">    }</span>

    public Map&lt;String, String&gt; getResourceAssignments() {
<span class="fc" id="L77">        return resourceAssignments;</span>
    }

    public void setResourceAssignments(Map&lt;String, String&gt; resourceAssignments) {
<span class="fc" id="L81">        this.resourceAssignments = resourceAssignments;</span>
<span class="fc" id="L82">    }</span>

    public Map&lt;String, List&lt;Appointment&gt;&gt; getResourceSchedules() {
<span class="fc" id="L85">        return resourceSchedules;</span>
    }

    public void setResourceSchedules(Map&lt;String, List&lt;Appointment&gt;&gt; resourceSchedules) {
<span class="fc" id="L89">        this.resourceSchedules = resourceSchedules;</span>
<span class="fc" id="L90">    }</span>

    public double getTotalCost() {
<span class="fc" id="L93">        return totalCost;</span>
    }

    public void setTotalCost(double totalCost) {
<span class="fc" id="L97">        this.totalCost = totalCost;</span>
<span class="fc" id="L98">    }</span>

    public double getTotalScore() {
<span class="fc" id="L101">        return totalScore;</span>
    }

    public void setTotalScore(double totalScore) {
<span class="fc" id="L105">        this.totalScore = totalScore;</span>
<span class="fc" id="L106">    }</span>

    public int getConflictCount() {
<span class="fc" id="L109">        return conflictCount;</span>
    }

    public void setConflictCount(int conflictCount) {
<span class="fc" id="L113">        this.conflictCount = conflictCount;</span>
<span class="fc" id="L114">    }</span>

    public Set&lt;String&gt; getUnassignedAppointments() {
<span class="fc" id="L117">        return unassignedAppointments;</span>
    }

    public void setUnassignedAppointments(Set&lt;String&gt; unassignedAppointments) {
<span class="fc" id="L121">        this.unassignedAppointments = unassignedAppointments;</span>
<span class="fc" id="L122">    }</span>

    public ScheduleMetrics getMetrics() {
<span class="fc" id="L125">        return metrics;</span>
    }

    public void setMetrics(ScheduleMetrics metrics) {
<span class="fc" id="L129">        this.metrics = metrics;</span>
<span class="fc" id="L130">    }</span>

    /**
     * Adds an appointment to the schedule with resource assignment.
     */
    public void addAppointment(Appointment appointment, String resourceId) {
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">        if (appointment == null) {</span>
<span class="nc" id="L137">            return;</span>
        }
        
<span class="fc" id="L140">        appointments.add(appointment);</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">        if (resourceId != null) {</span>
<span class="fc" id="L142">            resourceAssignments.put(appointment.getId(), resourceId);</span>
<span class="fc" id="L143">            resourceSchedules.computeIfAbsent(resourceId, k -&gt; new ArrayList&lt;&gt;()).add(appointment);</span>
            
            // Check for conflicts with existing appointments on the same resource
<span class="fc" id="L146">            checkForConflicts(appointment, resourceId);</span>
        } else {
<span class="fc" id="L148">            unassignedAppointments.add(appointment.getId());</span>
        }
<span class="fc" id="L150">    }</span>

    /**
     * Removes an appointment from the schedule.
     */
    public void removeAppointment(String appointmentId) {
<span class="fc" id="L156">        appointments.removeIf(apt -&gt; apt.getId().equals(appointmentId));</span>
<span class="fc" id="L157">        String resourceId = resourceAssignments.remove(appointmentId);</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">        if (resourceId != null) {</span>
<span class="fc" id="L159">            resourceSchedules.get(resourceId).removeIf(apt -&gt; apt.getId().equals(appointmentId));</span>
        }
<span class="fc" id="L161">        unassignedAppointments.remove(appointmentId);</span>
<span class="fc" id="L162">    }</span>

    /**
     * Gets all appointments for a specific resource.
     */
    public List&lt;Appointment&gt; getAppointmentsForResource(String resourceId) {
<span class="fc" id="L168">        return resourceSchedules.getOrDefault(resourceId, new ArrayList&lt;&gt;());</span>
    }

    /**
     * Gets the resource assigned to a specific appointment.
     */
    public String getResourceForAppointment(String appointmentId) {
<span class="fc" id="L175">        return resourceAssignments.get(appointmentId);</span>
    }

    /**
     * Checks if the schedule has any conflicts.
     */
    public boolean hasConflicts() {
<span class="fc bfc" id="L182" title="All 2 branches covered.">        return conflictCount &gt; 0;</span>
    }
    
    /**
     * Checks for conflicts between the new appointment and existing appointments on the same resource.
     */
    private void checkForConflicts(Appointment newAppointment, String resourceId) {
<span class="fc" id="L189">        List&lt;Appointment&gt; resourceAppointments = resourceSchedules.get(resourceId);</span>
<span class="pc bpc" id="L190" title="1 of 4 branches missed.">        if (resourceAppointments == null || resourceAppointments.size() &lt;= 1) {</span>
<span class="fc" id="L191">            return;</span>
        }
        
<span class="fc bfc" id="L194" title="All 2 branches covered.">        for (Appointment existingAppointment : resourceAppointments) {</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">            if (existingAppointment.getId().equals(newAppointment.getId())) {</span>
<span class="fc" id="L196">                continue; // Skip the same appointment</span>
            }
            
<span class="fc bfc" id="L199" title="All 2 branches covered.">            if (hasTimeConflict(newAppointment, existingAppointment)) {</span>
<span class="fc" id="L200">                conflictCount++;</span>
            }
<span class="fc" id="L202">        }</span>
<span class="fc" id="L203">    }</span>
    
    /**
     * Checks if two appointments have a time conflict.
     */
    private boolean hasTimeConflict(Appointment apt1, Appointment apt2) {
<span class="fc" id="L209">        LocalDateTime start1 = apt1.getStartTime();</span>
<span class="fc" id="L210">        LocalDateTime end1 = start1.plus(apt1.getDuration());</span>
<span class="fc" id="L211">        LocalDateTime start2 = apt2.getStartTime();</span>
<span class="fc" id="L212">        LocalDateTime end2 = start2.plus(apt2.getDuration());</span>
        
        // Check if appointments overlap
<span class="fc bfc" id="L215" title="All 4 branches covered.">        return start1.isBefore(end2) &amp;&amp; start2.isBefore(end1);</span>
    }

    /**
     * Calculates the utilization rate of resources.
     */
    public double calculateUtilizationRate() {
<span class="fc bfc" id="L222" title="All 2 branches covered.">        if (resourceSchedules.isEmpty()) {</span>
<span class="fc" id="L223">            return 0.0;</span>
        }
        
<span class="fc" id="L226">        long totalScheduledTime = 0;</span>
<span class="fc" id="L227">        long totalAvailableTime = 0;</span>
        
<span class="fc bfc" id="L229" title="All 2 branches covered.">        for (Map.Entry&lt;String, List&lt;Appointment&gt;&gt; entry : resourceSchedules.entrySet()) {</span>
<span class="fc" id="L230">            List&lt;Appointment&gt; resourceAppointments = entry.getValue();</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">            for (Appointment appointment : resourceAppointments) {</span>
<span class="fc" id="L232">                totalScheduledTime += appointment.getDuration().toMinutes();</span>
<span class="fc" id="L233">            }</span>
            
            // Calculate available time for this resource
<span class="fc" id="L236">            long availableMinutes = java.time.Duration.between(startDate, endDate).toMinutes();</span>
<span class="fc" id="L237">            totalAvailableTime += availableMinutes;</span>
<span class="fc" id="L238">        }</span>
        
<span class="pc bpc" id="L240" title="1 of 2 branches missed.">        return totalAvailableTime &gt; 0 ? (double) totalScheduledTime / totalAvailableTime : 0.0;</span>
    }

    /**
     * Calculates the efficiency score of the schedule.
     */
    public double calculateEfficiencyScore() {
<span class="fc bfc" id="L247" title="All 2 branches covered.">        if (appointments.isEmpty()) {</span>
<span class="fc" id="L248">            return 0.0;</span>
        }
        
<span class="fc" id="L251">        double utilizationScore = calculateUtilizationRate();</span>
<span class="fc" id="L252">        double conflictPenalty = Math.max(0, 1.0 - (conflictCount * 0.1));</span>
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        double assignmentScore = unassignedAppointments.isEmpty() ? 1.0 : </span>
<span class="pc" id="L254">            (double) (appointments.size() - unassignedAppointments.size()) / appointments.size();</span>
        
<span class="fc" id="L256">        return (utilizationScore * 0.4 + conflictPenalty * 0.4 + assignmentScore * 0.2) * 100;</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">        if (this == o) {</span>
<span class="nc" id="L262">            return true;</span>
        }
<span class="pc bpc" id="L264" title="2 of 4 branches missed.">        if (o == null || getClass() != o.getClass()) {</span>
<span class="nc" id="L265">            return false;</span>
        }
<span class="fc" id="L267">        Schedule schedule = (Schedule) o;</span>
<span class="fc" id="L268">        return Objects.equals(id, schedule.id);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L273">        return Objects.hash(id);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L278">        return &quot;Schedule{&quot; +</span>
                &quot;id='&quot; + id + '\'' +
                &quot;, startDate=&quot; + startDate +
                &quot;, endDate=&quot; + endDate +
<span class="fc" id="L282">                &quot;, appointmentCount=&quot; + appointments.size() +</span>
                &quot;, totalCost=&quot; + totalCost +
                &quot;, conflictCount=&quot; + conflictCount +
                '}';
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>